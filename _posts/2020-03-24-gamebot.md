---
layout: post
title: Abusing Detection in Online Games
date: 2020-03-24
categories: []
tag: []
comments: true
---
# Abusing Detection in Online Games 

* 게임에서의 Anomaly Detection (이상치 탐지) 방법을 쓰는 분야는 게임 내 어뷰징을 탐지하는 분야입니다.
* 따라서 어뷰징이 무엇인지, 어떤 방법을 통해 어뷰징을 방지하고 있는 지, 어뷰징을 탐지할 떄 어떻게 이상치 탐지 방법을 쓰고 있는 지에 대해 알아보고자 합니다.


---
## **Contents**
{:.no_toc}
0. this unordered seed list will be replaced by toc as unordered list
{:toc}

---
## Abusing and Others

이 분야를 공부할 때 가장 궁금했던 것은 게임 내의 어뷰징 (Abusing), 치팅 (Cheating), 핵 (Hack), 매크로 (Macro), 오토(Auto), 게임 봇(Game Bot), 파밍(Farming)이 어떤 의미적 차이를 가지는 지였습니다. 여러 논문과 강연들을 참조한 결과, 제가 생각핬을 때의 이들의 관계는 다음과 같습니다.

**어뷰징 (Abusing)** 이란 남용, 오용을 뜻하는 "Abuse"에서 파생된 단어로, 

* 게임 기획 의도와는 다르게 게임 정보를 대량 획득하거나 도움을 주거나 
* 게임 자체의 버그
* 허용되지 않은 외부 프로그램 (Hack)
* 복수 계정 등

을 이용해 게임 시스템의 허점을 악용해 이득을 취하는 행위를 뜻합니다. 
예를 들어 서비스 구현 상의 헛점을 이용한 플레이, 해킹 툴 이용, 전체 채팅창에 도배로 광고하는 행위, 고의로 져주는 승부 조작 모두 어뷰징에 속합니다.

어뷰징과 연관있는 단어로 **치팅 (Cheating), 핵 (Hack), 파밍 (Farming), 게임 봇 (Game Bot)** 이 있습니다. 

먼저 **치팅**은 제가 느끼기엔 어뷰징과 비슷하게 포괄적인 의미로, 게임 내의 불법적으로 이득을 취하는 행위를 일컫는 것 같습니다. [Dinh & Nguyen (2016)](https://www.researchgate.net/publication/309159777_An_Empirical_Study_of_Anomaly_Detection_in_Online_Games?_sg=7-Jt9zdR8-pI7GOAnPMFWoztGn_-KnP1g2gX0Fv_wyO6ELrdUbo8qYwSQ7fgNQQRN9r_O2aHiEtkKBo)에 따르면 온라인 게임에서의 치팅은 "다른 사용자에 비해 이득을 취하기 위해 게임 경험을 수정하는 일련의 행동"으로 정의되어 있습니다. 

이에 비해 **핵, 게임 봇, 파밍**은 치팅과 어뷰징보다 더 좁은 개념입니다.
먼저 **핵**은 게임 콘텐츠 내 중요 수치를 임의적으로 변경
하여 게임 플레이를 사용자 자신에게 유리하게 이끄는
프로그램 종류를 일컫는 말로, 프로그램을 해킹해 수정하여 원래 동작과 다른 동작을 유도하는 용도로 사용합니다. 
핵의 종류는 게임의 종류만큼 매우 다양합니다.
* 맵핵 (Map Hack): 아직 탐험하지 않아 볼 수 없는 영역이나 상대방 영역을 볼 수 있게 해주는 치팅 프로그램. 스타크래프트, 디아블로2와 같은 RTS (Real-Time Strategy) 게임에서 쓰임
* 에임핵 (Aim Hack): 적 출현 시 자동으로 타겟팅을 해주는 치팅 프로그램, 배틀그라운드나 오버워치와 같은 FPS (First Person Shooter) 게임에서 쓰임
* 월핵 (Wall Hack): 벽 너머에 있는 상대방을 벽을 통과해서 사격할 수 있도록 해주는 치팅 프로그램, 마찬가지로 FPS 게임에서 자주 쓰임
* 스피드핵 (Speed Hack): 서버와 클라이언트 간의 통신 속도를 조작해 빠른 속도로 이동하거나 같은 시간에 보다 많은 명령어를 수행할 수 있도록 하는 치팅 프로그램, 카트라이더와 같은 레이싱 게임이나 메이플스토리, 리니지와 같은 MMORPG (Massively Multi-Player Online Role-Playing Games)에서 쓰임

그 외에도 다양한 핵들이 존재합니다.

‘오토’는 사용자가 게임 플레
이를 진행하기 위해 입력 장치 등을 통해 반복적인 입력
을 대신 행하는 프로그램 종류를 말한다. 매크로도 오토
와 유사한 의미로 사용되는데, **오토**가 게임 내에서 이루
어지는 다수의 연속동작을 행하는 것에 비하여 **매크로**
는 하나의 행동에 필요한 일련의 게임 플레이 입력을 반
복해 주는 것으로 받아들여지고 있습니다. 이러한 핵과 오토ㄹ 프로그램
을 이용하여 게임을 플레이하는 게임 캐릭터나 그 행동
을 게임봇이라 부른다. 

핵과 비슷하게**게임 봇**입니다. 게임 봇은 유저 대신 게임을 하도록 만들어진 자동화 프로그램을 뜻합니다. 이러한 게임 봇은 게임 회사와 선량한 게임 유저 모두에게 피해를 줍니다.

* 게임 회사 입장에서는 게임 봇 차단을 위해 많은 비용과 노력을 들여야 하고, 게임 내 컨텐츠 소모가 빨라져서 (만렙이 순식간에 속속 출현한다거나, 고렙용 레어 아이템이 지천에 넘쳐난다거나…) 게임 운영이 어려워지는 문제가 발생할 수 있습니다.
* 선량한 게임 유저 입장에서는 게임봇 유저들이 월등히 빠른 속도로 레벨업을 해서 게임 내 부를 축적하게 되므로, 일반적으로 게임을 플레이하는 유저들이 상대적인 박탈감을 느끼게 됩니다.

그렇기 때문에, 이러한 게임 봇을 탐지하는 방법들이 많이 연구되어 왔습니다. 




---
## **Anomalies in Online Games**

온라인 게임에서의 Anomaly는 주로 사기 행각 (cheating behaviors)를 하는 유저들의 데이터입니다. 
사기 행각들은 어떤 프로그램을 

**Cheating** - **Abusing** Detection -> Game Bot Detection - Feature Engineering 


**1. 신규 오픈 채팅창이 광고글로 가득**

* 채팅을 이용한 스팸
  * 게임 내에서 전역 채팅으로 머니/아이템 판매 광고
  * 어뷰저는 프로그램적 판별을 막기 위해 메시지를 난독화
* 온라인 채팅 메시지 길이 분포는 일반적으로 로그 정규분포를 따른다고 알려져 있음
* 게임 내 채팅 메시지 길이 분포를 보면 온라인 채팅 메시지와 비슷하나 좀 더 두꺼운 경향 
* 스팸 메시지 검출: 자연어 처리 기계학습과 같은 고급 접근보다 간단한 통계적 접근!
  * 일반 메시지는 길이가 다양하고 빈도가 많지 않음
  * 스팸 메시지는 길이가 다양하지 않고 빈도는 높음
  * 검출 공식 spam ratio = 채팅 횟수 / 메시지 길이수, spam ratio가 기준 값 이상인 것을 스패머로 간주
* 구현이 간단했지만 오탐의 가능성이 있기 떄문에 **자연어 처리 기술** (TF-IDF) 도입
  
---
### **Abusing Detection with Machine Learning**

* 라이브 게임에서 각종 해킹 툴을 사용해서 **어뷰징 (파밍) 플레이**를 하는 상황
파밍: 아이템을 얻기 위한 부정 플레이
* 봇의 특성을 하나 둘로 특정하기 어려움 $$\rightarrow$$ 기계학습 필요!
* 지도 학습이 가능해서 딥러닝으로 하지 않음

:deciduous_tree: **준비 사항**

* 로그 수집 확인: 가장 오래 걸리고 어려운 작업
* 로그의 의미 / 구조 파악
* 학습을 위한 피처 (Feature) 추출ㅌ

:deciduous_tree: **로그 수집**

* 게임 서버는 대부분 윈도우 기반
* 리눅스 툴(fluentd, logstash, nxlog 등)을 검토했으나 윈도우 서버에 설치가 쉽지 않거나 SQL Server 관련 기능이 부족 -> 
자체 개발을 통해 로그 파일 및 SQLServer 동기, 파일 tailing 후 fluend 포워딩


:deciduous_tree: **피처 개발 (Feature Engineering)**

* 3개월 분량의 로그에서 하둡을 통해 피처 생성
* AWS의 EMR (AWS에서 사용하는 Hadoop 서비스) 사용
* Hadoop을 위한 로그 가공: 하둡은 작은 파일들이 많은 것에 취약해 이를 병합, 소팅, 압축할 필요가 있었음
* Hadoop MapReduce 코딩: `mrjob`
  * Yelp 에서 만든 Python 패키지
  * 하둡 스트림을 이용해 파이썬으로 MR 코딩
  * 로컬에서 샘플 데이터로 개발한 후 EMR에 올림
* GM이 제재하는 근거 (피처)와 제재된 리스트 구함
* 로그에서 "캐릭터" 기준으로 구함
* 정교한 피처보다는 다양한 피처를!
* 초기에 뽑아본 피처들: 로그인 횟수, 플레이 시간, 아이템/머니 습득 수, 퀘스트 종료수, NPC/ PC간 전투 수
플레이 시간은 로그 아웃 시간이 불분명했기 때문에 세션아웃 시간 (활동 로그가 5분 간 기록이 남았을 때)를 기준으로 플레이 시간 구함
* Boolean은 0,1로, 카테고리 타입은 OneHotEncoding을 통해 실수형으로 만듬

:deciduous_tree: **학습 진행: Decision Tree**

* 정작 기계학습 수행은 가벼우나 학습 모델의 하이퍼 파라미터를 최적화하는 과정이 좀 무거웠음 -> Spark와 같은 분산 시스템을 사용하는 경우도
* Decision Tree 사용: 파이썬의 Scikit-learn 패키지 사용
* 초기 결과로 평균 정확도 80% 정도

:deciduous_tree: **정확도 향상**

* 교차 검증 & GridSearch로 최적의 하이퍼 파라미터 찾음
* 평균 정확도 91%로 향상
* 새로운 피처 추가: 동시에 얻은 아이템/머니 수, 맵 반복 횟수, 특정 클래스만 선택, 캐릭터 이름의 랜덤 생성 여부, 움직이지 않고 아이템을 얻은 수
    * ex. 캐릭터 이름의 랜덤성 판단: 자/모의 출현 패턴
* 새로운 피처 추가로 평균 정확도로 96% 향상, but 오탐이 꽤 나옴
* 따라서 **Random Forest**로 교체

:deciduous_tree: **Random Forest**

* 정확도 95%
* 부당하게 징계를 받는 사례가 없도록 예측 확률이 높은 (>70%) 경우만 포함
* 재현율 (Recall): 전체 어뷰저 중 얼마나 찾았는가? 10 % 하락
* 정밀도 (Precision): 찾은 것 중 얼마나 진짜 어뷰저인가? 정밀도 100% 달성

:deciduous_tree: **만약 학습 데이터가 없으면?**

어뷰징을 군집으로 찾아보자

KMeans: 봇의 특성을 갖는 클러스터를 발견했으나 Random Forest보다 정확도는 떨어짐

학습 데이터가 없을 때 초기 데이터를 얻는 용도로!

---
### **이상 탐지**

* 비지도 학습이 적절함: 예외적인 것은 어렵고 자주 나타나지 않기 때때
* **게임 머니** 이상치 검출: Scikit-Learn의 EllipticEnvelope로 학습 후 레벨, 변동원인, 변량의 그래프
  * 대부분의 유저는 $10^8$ $$\pm 1$$억 변량 내에 있었으나, 그것을 뛰어넘는 경우가 많았음
* 정상범위 밖의 값들을 검출하기는 했으나 이들이 부정 플레이를 했다는 증거가 없음 -> 모니터링 정도


AWS Kinesis로 App 로그 수집
Fluentd / Elasticsearch - 실시간 로그 모니터링

---

1. Hadoop -> Spark로
2. 수작업된 특성에서 데이터에서 학습된 특성으로
3. 수동 제재 -> 자동 제재로


사용 중인 어뷰징 검출 특성들: 초록색 (Feature engineering), 핑크색 (딥러닝 - 데이터에서 학습된 특성) 

PyTorch - 간결함 + 디버깅 용이 -> 연구에 적합




https://engineering.linecorp.com/ko/blog/monitoring-to-prevent-game-cheating/

---
## **References**

* [NC Soft 블로그: 게임 봇의 두 얼굴](https://blog.ncsoft.com/%EA%B2%8C%EC%9E%84%EA%B3%BC-%EB%B3%B4%EC%95%88-1-%EA%B2%8C%EC%9E%84%EB%B4%87%EC%9D%98-%EB%91%90-%EC%96%BC%EA%B5%B4/)
* [최연준, 장성준, 김용준, & 이현주. (2014). 멀티 플레이어를 위한 온라인게임에서의 게임봇 대응 기술동향.](https://ettrends.etri.re.kr/ettrends/145/0905001932/29-1_83-92.pdf)
* [나무위키](https://namu.wiki/w/%EA%B2%8C%EC%9E%84%20%ED%95%B4%ED%82%B9%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%A8)